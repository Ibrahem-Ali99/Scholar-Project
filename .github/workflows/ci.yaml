name: Test CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [18.x, 20.x]

    steps:
    - uses: actions/checkout@v4
    
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'

    - name: Install dependencies
      run: |
        cd client
        npm ci
        npm install --save-dev eslint-plugin-react prop-types

    - name: Create ESLint config
      run: |
        cd client
        cat > .eslintrc.json << EOL
        {
          "extends": [
            "eslint:recommended",
            "plugin:react/recommended"
          ],
          "plugins": ["react"],
          "rules": {
            "react/react-in-jsx-scope": "off",
            "no-unused-vars": "warn"
          },
          "settings": {
            "react": {
              "version": "detect"
            }
          },
          "parserOptions": {
            "ecmaFeatures": {
              "jsx": true
            },
            "sourceType": "module"
          }
        }
        EOL

    - name: Fix ESLint issues
      run: |
        cd client
        npx eslint --fix src/**/*.{js,jsx}
        
    - name: Run lint check
      run: |
        cd client
        npm run lint